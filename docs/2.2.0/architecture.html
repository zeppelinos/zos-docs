<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Contracts Architecture · ZeppelinOS</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Contracts Architecture · ZeppelinOS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.zeppelinos.org/index.html"/><meta property="og:description" content="ZeppelinOS&#x27;s features such as upgrades, EVM package linking, and vouching, can all be used through the `zos` CLI with only one extra contract; The [ProxyAdmin](https://github.com/zeppelinos/zos/blob/v2.0.0/packages/lib/contracts/upgradeability/ProxyAdmin.sol) contract. ZeppelinOS uses this contract in order to avoid confusion around the [transparent proxy pattern](https://docs.zeppelinos.org/docs/pattern.html#transparent-proxies-and-function-clashes). This contract acts as a central admin for all proxies on your behalf, making their management as simple as possible, while retaining the highest safety standards. "/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102575245-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,200,300,400,500,700,400italic,700italic"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.svg" alt="ZeppelinOS"/></a><a href="/versions.html"><h3>2.2.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/2.2.0/start.html" target="_self">Quickstart</a></li><li class=""><a href="/docs/2.2.0/apis.html" target="_self">Reference</a></li><li class=""><a href="https://blog.zeppelinos.org" target="_self">Blog</a></li><li class=""><a href="https://forum.zeppelin.solutions" target="_self">Forum</a></li><li class=""><a href="https://github.com/zeppelinos" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>ADVANCED TOPICS</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>OVERVIEW</h3><ul><li class="navListItem"><a class="navItem" href="/docs/2.2.0/start.html">ZeppelinOS</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/new_2.html">What&#x27;s new in ZeppelinOS 2.0</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/new_2.2.html">What&#x27;s new in ZeppelinOS 2.2</a></li></ul></div><div class="navGroup navGroupActive"><h3>QUICKSTART</h3><ul><li class="navListItem"><a class="navItem" href="/docs/2.2.0/zepkit.html">ZepKit</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/deploying.html">Deploying your first project</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/upgrading.html">Upgrading your project</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/linking.html">Linking OpenZeppelin contracts</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/publishing.html">Publishing an EVM package</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/vouching.html">Vouching for EVM packages</a></li></ul></div><div class="navGroup navGroupActive"><h3>GUIDES</h3><ul><li class="navListItem"><a class="navItem" href="/docs/2.2.0/writing_contracts.html">Writing upgradeable contracts</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/testing.html">Testing upgradeable projects</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/erc20_onboarding.html">Onboarding ERC20 tokens</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/upgrades_governance.html">Upgrades governance</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/zos_lib.html">Using the ZeppelinOS programmatic library</a></li></ul></div><div class="navGroup navGroupActive"><h3>ADVANCED TOPICS</h3><ul><li class="navListItem"><a class="navItem" href="/docs/2.2.0/faq.html">Frequently asked questions</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/configuration.html">Configuration Files</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/2.2.0/architecture.html">Contracts Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/pattern.html">ZeppelinOS Upgrades Pattern</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/token_mechanics.html">ZEP Token Mechanics</a></li><li class="navListItem"><a class="navItem" href="/docs/2.2.0/whitepaper.html">Whitepaper</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Contracts Architecture</h1></header><article><div><span><p>ZeppelinOS's features such as upgrades, EVM package linking, and vouching, can all be used through the <code>zos</code> CLI with only one extra contract; The <a href="https://github.com/zeppelinos/zos/blob/v2.0.0/packages/lib/contracts/upgradeability/ProxyAdmin.sol">ProxyAdmin</a> contract. ZeppelinOS uses this contract in order to avoid confusion around the <a href="https://docs.zeppelinos.org/docs/pattern.html#transparent-proxies-and-function-clashes">transparent proxy pattern</a>. This contract acts as a central admin for all proxies on your behalf, making their management as simple as possible, while retaining the highest safety standards.</p>
<p>However, some additional smart contracts come into play when you want to publish your EVM package for others to reuse. Publishing is achieved by calling the command:</p>
<pre><code class="hljs css console">zos publish
</code></pre>
<p>The source code of the contracts involved with a published EVM package can be found in <a href="https://github.com/zeppelinos/zos/tree/master/packages/lib/contracts/application">zos/packages/lib/contracts/application</a>. In the following sections, we describe the general architecture of a ZeppelinOS published EVM package.</p>
<h2><a class="anchor" aria-hidden="true" id="appsol-https-githubcom-zeppelinos-zos-blob-v200-packages-lib-contracts-application-appsol"></a><a href="#appsol-https-githubcom-zeppelinos-zos-blob-v200-packages-lib-contracts-application-appsol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://github.com/zeppelinos/zos/blob/v2.0.0/packages/lib/contracts/application/App.sol">App.sol</a></h2>
<p>The App contract is the project's main entry point. Its most important function is to manage your project's &quot;providers&quot;. A provider is basically an EVM package identified by a name at a specific version. For example, a project may track your application's contracts in one provider named &quot;my-application&quot; at version &quot;0.0.1&quot;, an OpenZeppelin provider named &quot;openzeppelin-eth&quot; at version &quot;2.0.0&quot;, and a few other providers. These providers are your project's sources of on-chain logic.</p>
<p>The providers are mapped by name to <code>ProviderInfo</code> structs:</p>
<h4><a class="anchor" aria-hidden="true" id="appsol"></a><a href="#appsol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>App.sol</h4>
<pre><code class="hljs css solidity">
  <span class="hljs-comment">//...</span>

  mapping(<span class="hljs-built_in">string</span> =&gt; ProviderInfo) internal providers;

  <span class="hljs-comment">// ...</span>

  <span class="hljs-keyword">struct</span> ProviderInfo {
    Package <span class="hljs-keyword">package</span>;
    uint64[<span class="hljs-number">3</span>] <span class="hljs-keyword">version</span>;
  }

  <span class="hljs-comment">// ...</span>
</code></pre>
<p>When you upgrade one of your application's smart contracts, it is your application provider named &quot;my-application&quot; that is bumped to a new version, e.g. from &quot;0.0.1&quot; to &quot;0.0.2&quot;. On the other hand, when you decide to use a new version of the OpenZeppelin EVM package in your project, it is the &quot;openzeppelin-eth&quot; provider which is now pointed at the &quot;2.0.1&quot; version of the package, instead of &quot;2.0.0&quot;.</p>
<p>An EVM package is defined by the <code>Package</code> contract, as we'll see next.</p>
<p>NOTE: Additionally the <code>App</code> contract also facilitates the creation of proxies, by conveniently wrapping around the <code>AdminUpgradeabilityProxy</code> contract. For more info on direct usage of proxies, please see <a href="https://docs.zeppelinos.org/docs/low_level_contract.html">the low level usage section</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="packagesol-https-githubcom-zeppelinos-zos-blob-v200-packages-lib-contracts-application-packagesol"></a><a href="#packagesol-https-githubcom-zeppelinos-zos-blob-v200-packages-lib-contracts-application-packagesol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://github.com/zeppelinos/zos/blob/v2.0.0/packages/lib/contracts/application/Package.sol">Package.sol</a></h2>
<p>A <code>Package</code> contract tracks all the versions of a given EVM package. Following the example above, one package could be the &quot;application package&quot; associated to the name &quot;my-application&quot; containing all the contracts for version &quot;0.0.1&quot; of your application, and all the contracts for version &quot;0.0.2&quot; as well. Alternatively, another package could be an EVM package associated to the name &quot;openzeppelin-eth&quot; which contains a large number of versions &quot;x.y.z&quot; each of which contains a given set of contracts.</p>
<p>The versions are mapped by a semver hash to <code>Version</code> structs:</p>
<h4><a class="anchor" aria-hidden="true" id="packagesol"></a><a href="#packagesol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Package.sol</h4>
<pre><code class="hljs css solidity">
  <span class="hljs-string">//</span> <span class="hljs-string">..</span>

  mapping <span class="hljs-params">(<span class="hljs-attr">bytes32</span> =&gt; Version)</span> internal versions;

  <span class="hljs-string">//</span> <span class="hljs-string">..</span>

  struct Version {
    uint64[3] semanticVersion;
    address contractAddress;
    bytes contentURI;
  }

  <span class="hljs-string">//</span> <span class="hljs-string">..</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="implementationdirectory-https-githubcom-zeppelinos-zos-blob-v200-packages-lib-contracts-application-implementationdirectorysol"></a><a href="#implementationdirectory-https-githubcom-zeppelinos-zos-blob-v200-packages-lib-contracts-application-implementationdirectorysol" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="https://github.com/zeppelinos/zos/blob/v2.0.0/packages/lib/contracts/application/ImplementationDirectory.sol">ImplementationDirectory</a></h2>
<p>A version's <code>contractAddress</code> is an instance of the <code>ImplementationDirectory</code> contract, which is basically a mapping of contract aliases (or names) to deployed implementation instances. Continuing the example, your project's &quot;my-application&quot; package for version &quot;0.0.1&quot; could contain a directory with the following contracts:</p>
<p><strong>Directory for version &quot;0.0.1&quot; of the &quot;my-application&quot; package</strong></p>
<ul>
<li>Alias: &quot;MainContract&quot;, Implementation: &quot;0x0B06339ad63A875D4874dB7B7C921012BbFfe943&quot;</li>
<li>Alias: &quot;MyToken&quot;, Implementation: &quot;0x1b9a62585255981c85Acec022cDaC701132884f7&quot;</li>
</ul>
<p>While version &quot;0.0.2&quot; of the &quot;my-application&quot; package could look like this:</p>
<p><strong>Directory for version &quot;0.0.2&quot; of the &quot;my-application&quot; package</strong></p>
<ul>
<li>Alias: &quot;MainContract&quot;, Implementation: &quot;0x0B06339ad63A875D4874dB7B7C921012BbFfe943&quot;</li>
<li>Alias: &quot;MyToken&quot;, Implementation: &quot;0x724a43099d375e36c07be60c967b8bbbec985dc8&quot; &lt;--- this changed</li>
</ul>
<p>Notice how version &quot;0.0.2&quot; uses a new implementation for the &quot;MyToken&quot; contract.</p>
<p>Likewise, different versions of the &quot;openzeppelin-eth&quot; EVM package could contain different implementations for persisting aliases such as &quot;ERC20&quot;, &quot;ERC721&quot;, etc.</p>
<p>An <code>ImplementationDirectory</code> is a contract that adopts the <code>ImplemetationProvider</code> interface, which simply requires that for a given contract alias or name, the deployed address of a contract is provided. In this particular implementation of the interface, an <code>ImplementationDirectory</code> can be frozen, indicating that it will no longer be able to set or unset additional contracts and aliases.
This is helpful for making official releases of EVM packages, where the immutability of the package is guaranteed.</p>
<p>Other implementations of the interface could provide contracts without such a limitation, which makes the architecture pretty flexible, yet secure.</p>
<h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>The following diagram illustrates the interface of the contracts of published EVM packages:</p>
<p><img src="/img/zos2.png" alt="ZeppelinOS 2.x UML"></p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="configuration.html">← Configuration Files</a><a class="docs-next button" href="pattern.html">ZeppelinOS Upgrades Pattern →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/symbol-zeppelin.png" alt="ZeppelinOS" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/start.html">Guides</a><a href="/docs/apis.html">Reference</a></div><div><h5>Community</h5><a href="https://forum.zeppelin.solutions/" target="_blank">Forum</a><a href="https://t.me/zeppelinos/" target="_blank">Telegram chat</a></div><div><h5>More</h5><a href="https://zeppelinos.org">Main Site</a><a href="https://blog.zeppelinos.org">Blog</a><a href="https://github.com/zeppelinos">GitHub</a></div></section><a href="https://zeppelinos.org" target="_blank" class="fbOpenSource"><img src="/img/logo.svg" alt="ZeppelinOS" width="170" height="45"/></a><section class="copyright">Copyright © 2017-present ZeppelinOS Global</section><section class="report-bugs"><a href="https://github.com/zeppelinos/zos/issues/new?labels=kind:documentation">Report a bug on this site</a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '8d0b5afbba49947d9efb5659d1b08df7',
                indexName: 'zeppelinos',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>