<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Using the ZeppelinOS programmatic library · ZeppelinOS</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Using the ZeppelinOS programmatic library · ZeppelinOS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.zeppelinos.org/index.html"/><meta property="og:description" content="ZeppelinOS has a JavaScript library. It is mainly used by the `zos`"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102575245-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,200,300,400,500,700,400italic,700italic"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.svg" alt="ZeppelinOS"/></a><a href="/versions.html"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/next/start.html" target="_self">Quickstart</a></li><li class=""><a href="/docs/next/apis.html" target="_self">Reference</a></li><li class=""><a href="https://blog.zeppelinos.org" target="_self">Blog</a></li><li class=""><a href="https://forum.zeppelin.solutions" target="_self">Forum</a></li><li class=""><a href="https://github.com/zeppelinos" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>GUIDES</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>OVERVIEW</h3><ul><li class="navListItem"><a class="navItem" href="/docs/next/start.html">ZeppelinOS</a></li><li class="navListItem"><a class="navItem" href="/docs/next/new_2.html">What&#x27;s new in ZeppelinOS 2.0</a></li></ul></div><div class="navGroup navGroupActive"><h3>QUICKSTART</h3><ul><li class="navListItem"><a class="navItem" href="/docs/next/deploying.html">Deploying your first project</a></li><li class="navListItem"><a class="navItem" href="/docs/next/upgrading.html">Upgrading your project</a></li><li class="navListItem"><a class="navItem" href="/docs/next/linking.html">Linking to EVM packages</a></li><li class="navListItem"><a class="navItem" href="/docs/next/publishing.html">Publishing an EVM package</a></li><li class="navListItem"><a class="navItem" href="/docs/next/vouching.html">Vouching for EVM packages</a></li></ul></div><div class="navGroup navGroupActive"><h3>GUIDES</h3><ul><li class="navListItem"><a class="navItem" href="/docs/next/writing_contracts.html">Writing upgradeable contracts</a></li><li class="navListItem"><a class="navItem" href="/docs/next/testing.html">Testing upgradeable projects</a></li><li class="navListItem"><a class="navItem" href="/docs/next/erc20_onboarding.html">Onboarding ERC20 tokens</a></li><li class="navListItem"><a class="navItem" href="/docs/next/upgrades_governance.html">Upgrades governance</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/next/zos_lib.html">Using the ZeppelinOS programmatic library</a></li></ul></div><div class="navGroup navGroupActive"><h3>ADVANCED TOPICS</h3><ul><li class="navListItem"><a class="navItem" href="/docs/next/faq.html">Frequently asked questions</a></li><li class="navListItem"><a class="navItem" href="/docs/next/configuration.html">Configuration Files</a></li><li class="navListItem"><a class="navItem" href="/docs/next/architecture.html">Contracts Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/next/pattern.html">ZeppelinOS Upgrades Pattern</a></li><li class="navListItem"><a class="navItem" href="/docs/next/token_mechanics.html">ZEP Token Mechanics</a></li><li class="navListItem"><a class="navItem" href="/docs/next/whitepaper.html">Whitepaper</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Using the ZeppelinOS programmatic library</h1></header><article><div><span><p>ZeppelinOS has a JavaScript library. It is mainly used by the <code>zos</code>
command-line interface, which is the recommended way to use ZeppelinOS; but
this library can also be used directly to operate ZeppelinOS projects when a
programmatic interface is preferred or more flexibility and lower-level
access is required.</p>
<h2><a class="anchor" aria-hidden="true" id="install-node-and-npm"></a><a href="#install-node-and-npm" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install Node and NPM</h2>
<p>Let's install <a href="http://nodejs.org/">Node.js</a> and
<a href="https://npmjs.com/">npm</a>, which are the dependencies to get started. On their
respective websites you will find specific instructions for your machine.</p>
<h2><a class="anchor" aria-hidden="true" id="setting-up-your-project"></a><a href="#setting-up-your-project" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Setting up your project</h2>
<p>We'll need to create a directory for our project and access it:</p>
<pre><code class="hljs css console">mkdir my-project
cd my-project

</code></pre>
<p>Use <code>npm</code> to create a <code>package.json</code> file:</p>
<pre><code class="hljs css console">npm init
</code></pre>
<p>This command will ask you for details about the project. For this very basic
guide you can just press enter to accept the default values of each field.</p>
<p>Next, we need to install Truffle. To do so, run the following command:</p>
<pre><code class="hljs css console">npm install truffle@4.1.15
</code></pre>
<blockquote>
<p>Note: We are specifically installing Truffle 4.1.15, because ZeppelinOS 2.1 only supports that version of Truffle for its programmatic interface. Support for Truffle 5 is to be released in ZeppelinOS 2.2.</p>
</blockquote>
<p>We'll be using <a href="https://truffleframework.com/docs/ganache/quickstart">ganache</a> for local deployment, so let's install it:</p>
<pre><code class="hljs css console">npm install --global ganache-cli
</code></pre>
<p>Now, install the ZeppelinOS JavaScript library running:</p>
<pre><code class="hljs css console">npm install zos-lib
</code></pre>
<p>Finally, since we are creating this project manually, we need to create some folders and files to make our project compatible with Truffle:</p>
<pre><code class="hljs"><span class="hljs-built_in">mkdir</span> contracts
<span class="hljs-built_in">mkdir</span> migrations
touch truffle-<span class="hljs-built_in">config</span>.js
</code></pre>
<p>The contents of truffle-config.js should be:</p>
<pre><code class="hljs"><span class="hljs-string">module.exports</span> <span class="hljs-string">=</span> <span class="hljs-string">{</span>
<span class="hljs-attr">  networks:</span> <span class="hljs-string">{</span>
<span class="hljs-attr">    local:</span> <span class="hljs-string">{</span>
<span class="hljs-attr">      host:</span> <span class="hljs-string">'localhost'</span><span class="hljs-string">,</span>
<span class="hljs-attr">      port:</span> <span class="hljs-number">9545</span><span class="hljs-string">,</span>
<span class="hljs-attr">      gas:</span> <span class="hljs-number">5000000</span><span class="hljs-string">,</span>
<span class="hljs-attr">      gasPrice:</span> <span class="hljs-number">5e9</span><span class="hljs-string">,</span>
<span class="hljs-attr">      network_id:</span> <span class="hljs-string">'*'</span>
    <span class="hljs-string">}</span>
  <span class="hljs-string">}</span>
<span class="hljs-string">};</span>
</code></pre>
<p>That's it! Our project is now fully set up for using ZeppelinOS programmatically.</p>
<h2><a class="anchor" aria-hidden="true" id="adding-some-contracts"></a><a href="#adding-some-contracts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Adding some contracts</h2>
<p>Now, let's write two simple contracts. The first in <code>contracts/MyContractV0</code>
with the following contents:</p>
<pre><code class="hljs css solidity">pragma solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">24</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">"zos-lib/contracts/Initializable.sol"</span>;

contract MyContractV<span class="hljs-number">0</span> <span class="hljs-keyword">is</span> Initializable {
  uint<span class="hljs-number">256</span> public <span class="hljs-keyword">value</span>;

  <span class="hljs-keyword">function</span> initialize(uint<span class="hljs-number">256</span> <span class="hljs-number">_</span><span class="hljs-keyword">value</span>) initializer public {
    <span class="hljs-keyword">value</span> = <span class="hljs-number">_</span><span class="hljs-keyword">value</span>;
  }
}
</code></pre>
<p>The second in <code>contracts/MyContractV1</code>, and it will be almost the same as the
first one but with one extra function:</p>
<pre><code class="hljs css solidity">pragma solidity ^<span class="hljs-number">0.4</span>.<span class="hljs-number">24</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">"zos-lib/contracts/Initializable.sol"</span>;

contract MyContractV<span class="hljs-number">1</span> <span class="hljs-keyword">is</span> Initializable {
  uint<span class="hljs-number">256</span> public <span class="hljs-keyword">value</span>;

  <span class="hljs-keyword">function</span> initialize(uint<span class="hljs-number">256</span> <span class="hljs-number">_</span><span class="hljs-keyword">value</span>) initializer public {
    <span class="hljs-keyword">value</span> = <span class="hljs-number">_</span><span class="hljs-keyword">value</span>;
  }

  <span class="hljs-keyword">function</span> add(uint<span class="hljs-number">256</span> <span class="hljs-number">_</span><span class="hljs-keyword">value</span>) public {
    <span class="hljs-keyword">value</span> = <span class="hljs-keyword">value</span> + <span class="hljs-number">_</span><span class="hljs-keyword">value</span>;
  }
}
</code></pre>
<p>The V1 contract is an upgrade for the V0 contract, so let's see how we can
use the ZeppelinOS library to apply this upgrade. For this, we need to
compile the contracts:</p>
<h2><a class="anchor" aria-hidden="true" id="compiling-the-contracts"></a><a href="#compiling-the-contracts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compiling the contracts</h2>
<pre><code class="hljs css console">npx truffle compile
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="running-the-script"></a><a href="#running-the-script" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Running the script</h2>
<p>And now, let's write our upgrading script in <code>index.js</code>:</p>
<pre><code class="hljs css js"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-comment">// Required by zos-lib when running from truffle</span>
global.artifacts = artifacts;
global.web3 = web3;

<span class="hljs-keyword">const</span> { Contracts, SimpleProject  } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'zos-lib'</span>)
<span class="hljs-comment">// Load the contract.</span>
<span class="hljs-keyword">const</span> MyContractV0 = Contracts.getFromLocal(<span class="hljs-string">'MyContractV0'</span>);
<span class="hljs-keyword">const</span> MyContractV1 = Contracts.getFromLocal(<span class="hljs-string">'MyContractV1'</span>);

<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// Instantiate a project.</span>
  <span class="hljs-keyword">const</span> project = <span class="hljs-keyword">new</span> SimpleProject(<span class="hljs-string">'MyProject'</span>, { <span class="hljs-attr">from</span>: web3.eth.accounts[<span class="hljs-number">0</span>] });
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Creating an upgradeable instance of V0...'</span>);
  <span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">await</span> project.createProxy(MyContractV0, { <span class="hljs-attr">initArgs</span>: [<span class="hljs-number">42</span>] })
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Contract\'s storage value: '</span> + (<span class="hljs-keyword">await</span> proxy.value()).toString() + <span class="hljs-string">'\n'</span>);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Upgrading to v1...'</span>);
  <span class="hljs-keyword">await</span> project.upgradeProxy(proxy, MyContractV1, { <span class="hljs-attr">initMethod</span>: <span class="hljs-string">'add'</span>, <span class="hljs-attr">initArgs</span>: [<span class="hljs-number">1</span>], <span class="hljs-attr">initFrom</span>: initializerAddress })
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Contract\'s storage new value: '</span> + (<span class="hljs-keyword">await</span> instance.value()).toString() + <span class="hljs-string">'\n'</span>);
}

<span class="hljs-comment">// For truffle exec</span>
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
  main().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> callback()).catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> callback(err))
};
</code></pre>
<p>As you can see on the code, this script was prepared to be executed with
Truffle. So let's open a new terminal and start a ganache network by running:</p>
<pre><code class="hljs css console">ganache-cli --port 9545
</code></pre>
<p>And then, execute the script using Truffle:</p>
<pre><code class="hljs css console">npx truffle exec index.js --network local
</code></pre>
<p>This is just a very simple example to show the basic functions of the
ZeppelinOS JavaScript library. You can find more examples in the
<a href="https://github.com/zeppelinos/zos/tree/master/examples">ZeppelinOS repository</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="upgrades_governance.html">← Upgrades governance</a><a class="docs-next button" href="faq.html">Frequently asked questions →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/symbol-zeppelin.png" alt="ZeppelinOS" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/start.html">Guides</a><a href="/docs/apis.html">Reference</a></div><div><h5>Community</h5><a href="https://forum.zeppelin.solutions/" target="_blank">Forum</a><a href="https://t.me/zeppelinos/" target="_blank">Telegram chat</a></div><div><h5>More</h5><a href="https://zeppelinos.org">Main Site</a><a href="https://blog.zeppelinos.org">Blog</a><a href="https://github.com/zeppelinos">GitHub</a></div></section><a href="https://zeppelinos.org" target="_blank" class="fbOpenSource"><img src="/img/logo.svg" alt="ZeppelinOS" width="170" height="45"/></a><section class="copyright">Copyright © 2017-present ZeppelinOS Global</section><section class="report-bugs"><a href="https://github.com/zeppelinos/zos/issues/new?labels=kind:documentation">Report a bug on this site</a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '8d0b5afbba49947d9efb5659d1b08df7',
                indexName: 'zeppelinos',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>