<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Building an upgradeable application · ZeppelinOS</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Building an upgradeable application · ZeppelinOS"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.zeppelinos.org/index.html"/><meta property="og:description" content="After installing `zos` and setting up your ZeppelinOS project as described in the [setup](setup.html) guide, you are now ready to create your upgradeable application."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-102575245-1', 'auto');
              ga('send', 'pageview');
            </script><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:100,200,300,400,500,700,400italic,700italic"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.svg" alt="ZeppelinOS"/></a><a href="/versions.html"><h3>2.4.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/2.4.0/start.html" target="_self">Quickstart</a></li><li class=""><a href="/docs/2.4.0/apis.html" target="_self">Reference</a></li><li class=""><a href="https://blog.zeppelinos.org" target="_self">Blog</a></li><li class=""><a href="https://forum.zeppelin.solutions" target="_self">Forum</a></li><li class=""><a href="https://github.com/zeppelinos" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Building an upgradeable application</h1></header><article><div><span><p>After installing <code>zos</code> and setting up your ZeppelinOS project as described in the <a href="setup.html">setup</a> guide, you are now ready to create your upgradeable application.</p>
<p>Let's start by installing the <a href="https://github.com/zeppelinos/zos-lib">ZeppelinOS lib</a>, which you will need to make your contract code upgradeable.</p>
<pre><code class="hljs css sh">npm install zos-lib
</code></pre>
<p>Next, let's create a file named <code>MyContract.sol</code> in the <code>contracts/</code> folder with the following Solidity code:</p>
<pre><code class="hljs css js">pragma solidity ^<span class="hljs-number">0.4</span><span class="hljs-number">.21</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">"zos-lib/contracts/migrations/Migratable.sol"</span>;

contract MyContract is Migratable {
  uint256 public x;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span>(<span class="hljs-params">uint256 _x</span>) <span class="hljs-title">isInitializer</span>(<span class="hljs-params"><span class="hljs-string">"MyContract"</span>, <span class="hljs-string">"0"</span></span>) <span class="hljs-title">public</span> </span>{
    x = _x;
  }
}
</code></pre>
<p>Notice that your sample contract has an <code>initialize</code> function instead of the standard constructor. This is a requirement of <a href="proxies.md#the-constructor-caveat">ZeppelinOS initializer functions</a>.</p>
<p>Before deploying your upgradeable app to the network, you need to add your contract:</p>
<pre><code class="hljs css sh">zos add MyContract
</code></pre>
<p>Note that the <code>add</code> command compiles the contracts before adding them to your app, but you can always compile them manually using <code>npx truffle compile</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="initial-deployment"></a><a href="#initial-deployment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initial deployment</h2>
<p>The <code>zos init</code> command creates a <a href="http://truffleframework.com/docs/getting_started/project#alternative-migrating-with-ganache">Truffle configuration file</a> for you. If you want to use the provided 'local' development network, run your development node on port 9545 (For example <code>npx ganache-cli --port 9545</code>).</p>
<p>You can now push your application to this network:</p>
<pre><code class="hljs css sh">zos push --network <span class="hljs-built_in">local</span>
</code></pre>
<p>This creates a <code>zos.local.json</code> file with all the information about your app in this specific network. You can read more about this file format in the <a href="advanced.md#format-of-zosjson-and-zos-network-json-files">advanced topics</a> section. If you want to work with a different network, simply substitute the <code>local</code> parameter for <code>ropsten</code>, <code>rinkeby</code> or <code>mainnet</code> in the <code>zos push</code> command.</p>
<p>To create an upgradeable instance of your contract, you can run:</p>
<pre><code class="hljs css sh">zos create MyContract --init initialize --args 42 --network <span class="hljs-built_in">local</span>
</code></pre>
<p>The <code>create</code> command receives an optional <code>--init</code> parameter to call the initialization function after creating the contract, while the <code>--args</code> parameter allows you to pass arguments to it. This way, you are initializing your contract with <code>42</code> as the value of the <code>x</code> state variable.</p>
<blockquote>
<p><strong>Note</strong>: When calling an initializer with many variables, these should be passed as a comma-separated list, with no spaces in between.</p>
</blockquote>
<p>After these simple steps, your upgradeable application is now on-chain! Congratulations!</p>
<h2><a class="anchor" aria-hidden="true" id="upgrading-your-contract"></a><a href="#upgrading-your-contract" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrading your contract</h2>
<p>If, at a later stage, you want to upgrade your smart contract code in order to fix a bug or add a new feature, you can do it seamlessly using ZeppelinOS. Remember not to restart your development node, or you will lose your previous deployment!</p>
<blockquote>
<p><strong>Note</strong>: while ZeppelinOS supports arbitrary changes in functionality, you will need to preserve all variables that appear in prior versions of your contracts, declaring any new variables below the already existing ones. You can find more details in the <a href="advanced.html">advanced topics</a> page.</p>
</blockquote>
<p>Open <code>MyContract.sol</code> again, and add a new function:</p>
<pre><code class="hljs css js"><span class="hljs-keyword">import</span> <span class="hljs-string">"zos-lib/contracts/migrations/Migratable.sol"</span>;

contract MyContract is Migratable {
  uint256 public x;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span>(<span class="hljs-params">uint256 _x</span>) <span class="hljs-title">isInitializer</span>(<span class="hljs-params"><span class="hljs-string">"MyContract"</span>, <span class="hljs-string">"0"</span></span>) <span class="hljs-title">public</span> </span>{
    x = _x;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">increment</span>(<span class="hljs-params"></span>) <span class="hljs-title">public</span> </span>{
    x += <span class="hljs-number">1</span>;  
  }
}
</code></pre>
<p>Once you have saved the changes in your contract files, simply push the new code to the network:</p>
<pre><code class="hljs css sh">zos push --network <span class="hljs-built_in">local</span>
</code></pre>
<p>Finally, let's update the already deployed contract with the new code:</p>
<pre><code class="hljs css sh">zos update MyContract --network <span class="hljs-built_in">local</span>
</code></pre>
<p>This command outputs the address of your upgradeable MyContract instance (in white).</p>
<p><em>Voilà!</em> You have deployed and upgraded an application using ZeppelinOS. The address of the upgraded contract is the same as before, but the code has been updated to the new version.</p>
<p>To try the upgraded feature we just added, run:</p>
<pre><code class="hljs css sh">npx truffle console --network=<span class="hljs-built_in">local</span>
truffle(<span class="hljs-built_in">local</span>)&gt; myContract = MyContract.at(&lt;your-proxy-address&gt;)
truffle(<span class="hljs-built_in">local</span>)&gt; myContract.increment()
truffle(<span class="hljs-built_in">local</span>)&gt; myContract.x()
43
</code></pre>
<p>In order to learn how to use the ZeppelinOS standard libraries in an upgradeable app, please follow the <a href="using.html">next guide</a>.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/symbol-zeppelin.png" alt="ZeppelinOS" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/start.html">Guides</a><a href="/docs/apis.html">Reference</a></div><div><h5>Community</h5><a href="https://forum.zeppelin.solutions/" target="_blank">Forum</a><a href="https://t.me/zeppelinos/" target="_blank">Telegram chat</a></div><div><h5>More</h5><a href="https://zeppelinos.org">Main Site</a><a href="https://blog.zeppelinos.org">Blog</a><a href="https://github.com/zeppelinos">GitHub</a></div></section><a href="https://zeppelinos.org" target="_blank" class="fbOpenSource"><img src="/img/logo.svg" alt="ZeppelinOS" width="170" height="45"/></a><section class="copyright">Copyright © 2017-present ZeppelinOS Global</section><section class="report-bugs"><a href="https://github.com/zeppelinos/zos/issues/new?labels=kind:documentation">Report a bug on this site</a></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '8d0b5afbba49947d9efb5659d1b08df7',
                indexName: 'zeppelinos',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>